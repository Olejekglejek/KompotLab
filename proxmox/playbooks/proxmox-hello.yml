
- hosts: proxmox
  gather_facts: false
  vars:
    secrets: "{{ lookup('file', '../../.env/secrets.yml') | from_yaml }}"
    ansible_host: "{{ secrets.ansible_host }}"
    ansible_ssh_user: "{{ secrets.ansible_ssh_user }}"
    ansible_ssh_pass: "{{ secrets.ansible_ssh_pass }}"
    ansible_become_pass: "{{ secrets.ansible_become_pass }}"

  tasks:
    - name: Message
      debug:
        msg: |
          Hello World!
          This is playbook for testing connection to Proxmox VE.

    - name: List Proxmox VMs
      command: "qm list"
      register: vm_list

    - name: Show VM List
      debug:
        var: vm_list.stdout_lines
